<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SmartEnv Monitor - Environmental Monitoring System</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/firebase/9.23.0/firebase-app-compat.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/firebase/9.23.0/firebase-database-compat.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            background: linear-gradient(45deg, #fff, #f0f0f0);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }

        .status-bar {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        .connection-status {
            display: flex;
            align-items: center;
            font-weight: 600;
        }

        .status-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 10px;
            animation: pulse 2s infinite;
        }

        .status-dot.connected {
            background: #10b981;
        }

        .status-dot.disconnected {
            background: #ef4444;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }

        .last-update {
            color: #6b7280;
            font-size: 0.9em;
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }

        .sensor-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .sensor-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.15);
        }

        .sensor-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--accent-color);
        }

        .sensor-card.temperature::before {
            background: linear-gradient(45deg, #ff6b6b, #ff8e53);
        }

        .sensor-card.humidity::before {
            background: linear-gradient(45deg, #4facfe, #00f2fe);
        }

        .sensor-card.gas::before {
            background: linear-gradient(45deg, #43e97b, #38f9d7);
        }

        .sensor-card.light::before {
            background: linear-gradient(45deg, #ffeaa7, #fab1a0);
        }

        .sensor-header {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
        }

        .sensor-icon {
            font-size: 2.5em;
            margin-right: 15px;
            padding: 15px;
            border-radius: 15px;
            color: white;
        }

        .temperature .sensor-icon {
            background: linear-gradient(45deg, #ff6b6b, #ff8e53);
        }

        .humidity .sensor-icon {
            background: linear-gradient(45deg, #4facfe, #00f2fe);
        }

        .gas .sensor-icon {
            background: linear-gradient(45deg, #43e97b, #38f9d7);
        }

        .light .sensor-icon {
            background: linear-gradient(45deg, #ffeaa7, #fab1a0);
            color: #333;
        }

        .sensor-title {
            font-size: 1.3em;
            font-weight: 700;
            color: #2d3748;
        }

        .sensor-description {
            font-size: 0.9em;
            color: #6b7280;
            margin-top: 5px;
        }

        .sensor-value {
            font-size: 3em;
            font-weight: 800;
            margin: 20px 0;
            background: linear-gradient(45deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .sensor-unit {
            font-size: 0.4em;
            opacity: 0.7;
        }

        .sensor-status {
            display: flex;
            align-items: center;
            padding: 12px 20px;
            border-radius: 10px;
            font-weight: 600;
            margin-top: 15px;
        }

        .status-normal {
            background: #dcfce7;
            color: #166534;
        }

        .status-warning {
            background: #fef3c7;
            color: #92400e;
        }

        .status-danger {
            background: #fee2e2;
            color: #991b1b;
        }

        .charts-section {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .charts-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }

        .charts-title {
            font-size: 1.8em;
            font-weight: 700;
            color: #2d3748;
        }

        .time-selector {
            display: flex;
            gap: 10px;
        }

        .time-btn {
            padding: 8px 16px;
            border: 2px solid #667eea;
            background: transparent;
            color: #667eea;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .time-btn.active {
            background: #667eea;
            color: white;
        }

        .chart-container {
            height: 400px;
            margin-bottom: 20px;
        }

        .alerts-section {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            max-width: 400px;
        }

        .alert {
            background: #fee2e2;
            border: 1px solid #fecaca;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 10px;
            color: #991b1b;
            display: none;
            animation: slideIn 0.3s ease;
        }

        .alert.info {
            background: #dbeafe;
            border: 1px solid #bfdbfe;
            color: #1e40af;
        }

        .alert.success {
            background: #dcfce7;
            border: 1px solid #bbf7d0;
            color: #166534;
        }

        .alert.warning {
            background: #fef3c7;
            border: 1px solid #fde68a;
            color: #92400e;
        }

        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .loading {
            display: flex;
            align-items: center;
            justify-content: center;
            color: #6b7280;
            font-style: italic;
        }

        .firebase-status {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 20px;
            margin-top: 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            text-align: center;
        }

        .firebase-info {
            color: #6b7280;
            font-size: 0.9em;
            margin-top: 10px;
        }

        .demo-mode {
            background: rgba(255, 234, 167, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 20px;
            margin-top: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            text-align: center;
            border: 2px solid #fbbf24;
        }

        @media (max-width: 768px) {
            .dashboard-grid {
                grid-template-columns: 1fr;
            }
            
            .charts-header {
                flex-direction: column;
                gap: 15px;
            }
            
            .alerts-section {
                position: relative;
                top: auto;
                right: auto;
                margin-top: 20px;
            }

            .header h1 {
                font-size: 2em;
            }

            .sensor-value {
                font-size: 2.5em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header class="header">
            <h1><i class="fas fa-microchip"></i> GEER Monitor</h1>
            <p>Sistem Monitoring Lingkungan Cerdas Real-time</p>
        </header>

        <div class="status-bar">
            <div class="connection-status">
                <div class="status-dot disconnected" id="statusDot"></div>
                <span id="connectionStatus">Menghubungkan ke Firebase...</span>
            </div>
            <div class="last-update">
                <i class="fas fa-clock"></i>
                <span id="lastUpdate">Belum ada data</span>
            </div>
        </div>

        <div class="dashboard-grid">
            <div class="sensor-card temperature">
                <div class="sensor-header">
                    <div class="sensor-icon">
                        <i class="fas fa-thermometer-half"></i>
                    </div>
                    <div>
                        <div class="sensor-title">Suhu Udara</div>
                        <div class="sensor-description">Sensor DHT22</div>
                    </div>
                </div>
                <div class="sensor-value" id="temperature">
                    <span class="loading">Loading...</span>
                </div>
                <div class="sensor-status status-normal" id="tempStatus">
                    <i class="fas fa-check-circle"></i>
                    <span>Normal</span>
                </div>
            </div>

            <div class="sensor-card humidity">
                <div class="sensor-header">
                    <div class="sensor-icon">
                        <i class="fas fa-tint"></i>
                    </div>
                    <div>
                        <div class="sensor-title">Kelembaban</div>
                        <div class="sensor-description">Sensor DHT22</div>
                    </div>
                </div>
                <div class="sensor-value" id="humidity">
                    <span class="loading">Loading...</span>
                </div>
                <div class="sensor-status status-normal" id="humidityStatus">
                    <i class="fas fa-check-circle"></i>
                    <span>Normal</span>
                </div>
            </div>

            <div class="sensor-card gas">
                <div class="sensor-header">
                    <div class="sensor-icon">
                        <i class="fas fa-gas-pump"></i>
                    </div>
                    <div>
                        <div class="sensor-title">Kualitas Udara</div>
                        <div class="sensor-description">Sensor MQ135</div>
                    </div>
                </div>
                <div class="sensor-value" id="gas">
                    <span class="loading">Loading...</span>
                </div>
                <div class="sensor-status status-normal" id="gasStatus">
                    <i class="fas fa-check-circle"></i>
                    <span>Baik</span>
                </div>
            </div>

            <div class="sensor-card light">
                <div class="sensor-header">
                    <div class="sensor-icon">
                        <i class="fas fa-sun"></i>
                    </div>
                    <div>
                        <div class="sensor-title">Intensitas Cahaya</div>
                        <div class="sensor-description">Sensor LDR</div>
                    </div>
                </div>
                <div class="sensor-value" id="light">
                    <span class="loading">Loading...</span>
                </div>
                <div class="sensor-status status-normal" id="lightStatus">
                    <i class="fas fa-check-circle"></i>
                    <span>Optimal</span>
                </div>
            </div>
        </div>

        <div class="charts-section">
            <div class="charts-header">
                <h2 class="charts-title">
                    <i class="fas fa-chart-line"></i>
                    Grafik Real-time
                </h2>
                <div class="time-selector">
                    <button class="time-btn active" data-range="1h">1 Jam</button>
                    <button class="time-btn" data-range="6h">6 Jam</button>
                    <button class="time-btn" data-range="24h">24 Jam</button>
                </div>
            </div>
            <div class="chart-container">
                <canvas id="environmentChart"></canvas>
            </div>
        </div>

        <div class="firebase-status">
            <h3 style="color: #2d3748; margin-bottom: 10px;">
                <i class="fas fa-database"></i>
                Status Firebase
            </h3>
            <div id="firebaseStatus">Terhubung ke Firebase Realtime Database</div>
            <div class="firebase-info" id="firebaseInfo">
                Database: monitoring-1e176-default-rtdb.asia-southeast1.firebasedatabase.app<br>
                Path: /sensor
            </div>
        </div>
    </div>

    <div class="alerts-section" id="alertsContainer">
        <!-- Alerts will be dynamically added here -->
    </div>

    <script>
        // Firebase configuration - Update dengan konfigurasi Firebase Anda yang sebenarnya
const firebaseConfig = {
  apiKey: "AIzaSyA_AjJk02F2F9OVxfpBzb9NRroxNmSNkK8",
  authDomain: "monitoring-1e176.firebaseapp.com",
  databaseURL: "https://monitoring-1e176-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "monitoring-1e176",
  storageBucket: "monitoring-1e176.firebasestorage.app",
  messagingSenderId: "739652482804",
  appId: "1:739652482804:web:38300e5bb87396433550a1"
};
        // Global variables
        let firebaseApp = null;
        let database = null;
        let sensorRef = null;
        let chart = null;
        let isConnected = false;
        let isDemoMode = false;
        let demoInterval = null;
        
        // Data storage
        let sensorData = {
            temperature: [],
            humidity: [],
            gas: [],
            light: [],
            timestamps: []
        };

        // Threshold values for sensors - disesuaikan dengan kebutuhan
        const thresholds = {
            temperature: { min: 18, max: 35 },      // °C - batas normal suhu ruangan
            humidity: { min: 30, max: 80 },         // % - batas normal kelembaban
            gas: { max: 300 },                      // Nilai analog MQ135 (0-1023), 300 adalah batas aman
            light: { min: 500, max: 4000 }          // Nilai analog LDR (0-4095), untuk kondisi cahaya optimal
        };

        // Initialize chart
        function initChart() {
            const ctx = document.getElementById('environmentChart').getContext('2d');
            chart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [
                        {
                            label: 'Suhu (°C)',
                            data: [],
                            borderColor: '#ff6b6b',
                            backgroundColor: 'rgba(255, 107, 107, 0.1)',
                            tension: 0.4,
                            fill: true
                        },
                        {
                            label: 'Kelembaban (%)',
                            data: [],
                            borderColor: '#4facfe',
                            backgroundColor: 'rgba(79, 172, 254, 0.1)',
                            tension: 0.4,
                            fill: true
                        },
                        {
                            label: 'Kualitas Udara (MQ135)',
                            data: [],
                            borderColor: '#43e97b',
                            backgroundColor: 'rgba(67, 233, 123, 0.1)',
                            tension: 0.4,
                            fill: true,
                            yAxisID: 'y1'
                        },
                        {
                            label: 'Intensitas Cahaya (LDR)',
                            data: [],
                            borderColor: '#ffeaa7',
                            backgroundColor: 'rgba(255, 234, 167, 0.1)',
                            tension: 0.4,
                            fill: true,
                            yAxisID: 'y1'
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'top',
                            labels: {
                                usePointStyle: true,
                                font: {
                                    weight: 'bold'
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            type: 'linear',
                            display: true,
                            position: 'left',
                            title: {
                                display: true,
                                text: 'Suhu (°C) / Kelembaban (%)'
                            }
                        },
                        y1: {
                            type: 'linear',
                            display: true,
                            position: 'right',
                            title: {
                                display: true,
                                text: 'MQ135 / LDR (Analog)'
                            },
                            grid: {
                                drawOnChartArea: false,
                            },
                        },
                        x: {
                            title: {
                                display: true,
                                text: 'Waktu'
                            }
                        }
                    },
                    animation: {
                        duration: 1000,
                        easing: 'easeInOutQuart'
                    }
                }
            });
        }

        // Initialize Firebase connection
        function initializeFirebase() {
            try {
                firebaseApp = firebase.initializeApp(firebaseConfig);
                database = firebase.database();
                sensorRef = database.ref('/sensor'); // Menggunakan path /sensor sesuai struktur Firebase

                // Listen for data changes
                sensorRef.on('value', (snapshot) => {
                    const data = snapshot.val();
                    console.log('Data dari Firebase:', data); // Debug log
                    if (data) {
                        updateSensorData(data);
                        updateConnectionStatus(true);
                    }
                }, (error) => {
                    console.error('Firebase error:', error);
                    updateConnectionStatus(false);
                    showAlert('Error connecting to Firebase: ' + error.message, 'error');
                    startDemoMode();
                });

                // Connection state monitoring
                const connectedRef = database.ref('.info/connected');
                connectedRef.on('value', (snapshot) => {
                    if (snapshot.val() === true) {
                        updateConnectionStatus(true);
                        showAlert('Berhasil terhubung ke Firebase!', 'success');
                    } else {
                        updateConnectionStatus(false);
                        showAlert('Koneksi Firebase terputus', 'warning');
                    }
                });

            } catch (error) {
                console.error('Firebase initialization error:', error);
                updateConnectionStatus(false);
                showAlert('Error initializing Firebase: ' + error.message, 'error');
                // Start demo mode if Firebase fails
                startDemoMode();
            }
        }

        // Update sensor data display
        function updateSensorData(data) {
            const now = new Date();
            const timeStr = now.toLocaleTimeString('id-ID');

            // Update temperature - ambil dari data.suhu
            if (data.suhu !== undefined) {
                const tempValue = parseFloat(data.suhu);
                document.getElementById('temperature').innerHTML = `${tempValue.toFixed(1)}<span class="sensor-unit">°C</span>`;
                updateSensorStatus('temperature', tempValue, thresholds.temperature);
                addDataPoint('temperature', tempValue, timeStr);
            }

            // Update humidity - ambil dari data.kelembaban
            if (data.kelembaban !== undefined) {
                const humidityValue = parseFloat(data.kelembaban);
                document.getElementById('humidity').innerHTML = `${humidityValue.toFixed(1)}<span class="sensor-unit">%</span>`;
                updateSensorStatus('humidity', humidityValue, thresholds.humidity);
                addDataPoint('humidity', humidityValue, timeStr);
            }

            // Update gas (MQ135) - ambil dari data.mq135.analog
            if (data.mq135 && data.mq135.analog !== undefined) {
                const gasValue = parseInt(data.mq135.analog);
                document.getElementById('gas').innerHTML = `${gasValue}<span class="sensor-unit">ppm</span>`;
                updateSensorStatus('gas', gasValue, { max: thresholds.gas.max });
                addDataPoint('gas', gasValue, timeStr);
            }

            // Update light (LDR) - ambil dari data.ldr.analog
            if (data.ldr && data.ldr.analog !== undefined) {
                const lightValue = parseInt(data.ldr.analog);
                document.getElementById('light').innerHTML = `${lightValue}<span class="sensor-unit">lux</span>`;
                updateSensorStatus('light', lightValue, thresholds.light);
                addDataPoint('light', lightValue, timeStr);
            }

            // Update last update time
            document.getElementById('lastUpdate').textContent = `Terakhir update: ${now.toLocaleString('id-ID')}`;

            // Update chart
            updateChart();
        }

        // Update sensor status based on thresholds
        function updateSensorStatus(sensor, value, threshold) {
            const statusMap = {
                'temperature': 'tempStatus',
                'humidity': 'humidityStatus',
                'gas': 'gasStatus',
                'light': 'lightStatus'
            };
            
            const statusElement = document.getElementById(statusMap[sensor]);
            
            let status = 'normal';
            let statusText = 'Normal';
            let icon = 'fas fa-check-circle';
            let alertMessage = '';

            if (sensor === 'temperature') {
                if (value < threshold.min) {
                    status = 'warning';
                    statusText = 'Terlalu Dingin';
                    icon = 'fas fa-thermometer-empty';
                    alertMessage = `Suhu terlalu rendah: ${value.toFixed(1)}°C`;
                } else if (value > threshold.max) {
                    status = 'danger';
                    statusText = 'Terlalu Panas';
                    icon = 'fas fa-thermometer-full';
                    alertMessage = `Suhu terlalu tinggi: ${value.toFixed(1)}°C`;
                }
            } else if (sensor === 'humidity') {
                if (value < threshold.min) {
                    status = 'warning';
                    statusText = 'Terlalu Kering';
                    icon = 'fas fa-exclamation-triangle';
                    alertMessage = `Kelembaban terlalu rendah: ${value.toFixed(1)}%`;
                } else if (value > threshold.max) {
                    status = 'danger';
                    statusText = 'Terlalu Lembab';
                    icon = 'fas fa-exclamation-circle';
                    alertMessage = `Kelembaban terlalu tinggi: ${value.toFixed(1)}%`;
                }
            } else if (sensor === 'gas') {
                if (value > threshold.max) {
                    status = 'danger';
                    statusText = 'Berbahaya';
                    icon = 'fas fa-exclamation-circle';
                    alertMessage = `Kualitas udara buruk (MQ135): ${value}`;
                } else {
                    statusText = 'Baik';
                }
            } else if (sensor === 'light') {
                if (value < threshold.min) {
                    status = 'warning';
                    statusText = 'Gelap';
                    icon = 'fas fa-moon';
                    alertMessage = `Intensitas cahaya rendah (LDR): ${value}`;
                } else if (value > threshold.max) {
                    status = 'warning';
                    statusText = 'Terlalu Terang';
                    icon = 'fas fa-sun';
                    alertMessage = `Intensitas cahaya tinggi (LDR): ${value}`;
                } else {
                    statusText = 'Optimal';
                }
            }

            statusElement.className = `sensor-status status-${status}`;
            statusElement.innerHTML = `<i class="${icon}"></i><span>${statusText}</span>`;

            // Show alert if there's a problem
            if (alertMessage && !isDemoMode) {
                showAlert(alertMessage, status === 'danger' ? 'error' : 'warning');
            }
        }

        // Add data point to storage
        function addDataPoint(sensor, value, timestamp) {
            sensorData[sensor].push(value);
            if (sensorData.timestamps.indexOf(timestamp) === -1) {
                sensorData.timestamps.push(timestamp);
            }

            // Keep only last 50 data points for performance
            if (sensorData[sensor].length > 50) {
                sensorData[sensor].shift();
            }
            if (sensorData.timestamps.length > 50) {
                sensorData.timestamps.shift();
            }
        }

        // Update chart with new data
        function updateChart() {
            if (!chart) return;

            chart.data.labels = sensorData.timestamps;
            chart.data.datasets[0].data = sensorData.temperature;
            chart.data.datasets[1].data = sensorData.humidity;
            chart.data.datasets[2].data = sensorData.gas;
            chart.data.datasets[3].data = sensorData.light;
            
            chart.update('none');
        }

        // Update connection status indicator
        function updateConnectionStatus(connected) {
            isConnected = connected;
            const statusDot = document.getElementById('statusDot');
            const statusText = document.getElementById('connectionStatus');

            if (connected && !isDemoMode) {
                statusDot.className = 'status-dot connected';
                statusText.textContent = 'Terhubung ke Firebase';
            } else if (isDemoMode) {
                statusDot.className = 'status-dot connected';
                statusText.textContent = 'Mode Demo (Data Simulasi)';
            } else {
                statusDot.className = 'status-dot disconnected';
                statusText.textContent = 'Terputus dari Firebase';
            }
        }

        // Show alert notification
        function showAlert(message, type) {
            const alertsContainer = document.getElementById('alertsContainer');
            const alert = document.createElement('div');
            alert.className = `alert ${type}`;
            alert.innerHTML = `
                <div style="display: flex; align-items: center;">
                    <i class="fas fa-${type === 'error' ? 'exclamation-circle' : type === 'warning' ? 'exclamation-triangle' : type === 'success' ? 'check-circle' : 'info-circle'}" style="margin-right: 10px;"></i>
                    <span>${message}</span>
                </div>
            `;
            
            alertsContainer.appendChild(alert);
            alert.style.display = 'block';

            // Auto remove after 5 seconds
            setTimeout(() => {
                alert.remove();
            }, 5000);
        }

        // Demo mode for testing without Firebase
        function startDemoMode() {
            isDemoMode = true;
            updateConnectionStatus(false);
            
            // Show demo mode notification
            const firebaseStatus = document.getElementById('firebaseStatus');
            firebaseStatus.innerHTML = `
                <div class="demo-mode">
                    <h4 style="color: #92400e; margin-bottom: 10px;">
                        <i class="fas fa-exclamation-triangle"></i>
                        Mode Demo Aktif
                    </h4>
                    <p>Firebase tidak tersedia. Menampilkan data simulasi untuk demo.</p>
                </div>
            `;

            showAlert('Mode demo aktif - menampilkan data simulasi', 'info');

            // Generate demo data
            generateDemoData();

            // Update demo data every 5 seconds
            demoInterval = setInterval(() => {
                generateDemoData();
            }, 5000);
        }

        // Generate realistic demo sensor data
        function generateDemoData() {
            const now = new Date();
            const hour = now.getHours();
            
            // Simulate realistic temperature based on time of day
            let baseTemp = 25;
            if (hour >= 6 && hour <= 8) baseTemp = 22; // Morning
            else if (hour >= 9 && hour <= 11) baseTemp = 28; // Late morning
            else if (hour >= 12 && hour <= 15) baseTemp = 32; // Afternoon
            else if (hour >= 16 && hour <= 18) baseTemp = 29; // Evening
            else if (hour >= 19 && hour <= 23) baseTemp = 26; // Night
            else baseTemp = 24; // Late night/early morning

            // Add some random variation
            const temperature = baseTemp + (Math.random() - 0.5) * 4;
            
            // Humidity inversely related to temperature (somewhat)
            const humidity = 75 - (temperature - 25) * 2 + (Math.random() - 0.5) * 15;
            
            // Gas levels - normally low, occasionally spike
            const gasSpike = Math.random() < 0.1; // 10% chance of spike
            const gas = gasSpike ? 200 + Math.random() * 400 : 50 + Math.random() * 100;
            
            // Light levels based on time of day
            let baseLight = 1000;
            if (hour >= 6 && hour <= 7) baseLight = 800; // Dawn
            else if (hour >= 8 && hour <= 17) baseLight = 3000; // Daylight
            else if (hour >= 18 && hour <= 19) baseLight = 1500; // Dusk
            else baseLight = 200; // Night

            const light = Math.max(0, baseLight + (Math.random() - 0.5) * 500);

            // Create demo data object
            const demoData = {
                suhu: temperature,
                kelembaban: Math.max(20, Math.min(100, humidity)),
                mq135: {
                    analog: Math.round(gas)
                },
                ldr: {
                    analog: Math.round(light)
                }
            };

            // Update display with demo data
            updateSensorData(demoData);
        }

        // Time selector functionality
        function initTimeSelector() {
            const timeButtons = document.querySelectorAll('.time-btn');
            timeButtons.forEach(btn => {
                btn.addEventListener('click', (e) => {
                    // Remove active class from all buttons
                    timeButtons.forEach(b => b.classList.remove('active'));
                    // Add active class to clicked button
                    e.target.classList.add('active');
                    
                    const range = e.target.dataset.range;
                    console.log(`Time range changed to: ${range}`);
                    // Here you could implement different time range filtering
                });
            });
        }

        // Export data functionality
        function exportData() {
            const csvContent = "data:text/csv;charset=utf-8," 
                + "Timestamp,Temperature,Humidity,Gas,Light\n"
                + sensorData.timestamps.map((time, index) => {
                    return `${time},${sensorData.temperature[index] || ''},${sensorData.humidity[index] || ''},${sensorData.gas[index] || ''},${sensorData.light[index] || ''}`;
                }).join("\n");

            const encodedUri = encodeURI(csvContent);
            const link = document.createElement("a");
            link.setAttribute("href", encodedUri);
            link.setAttribute("download", `sensor_data_${new Date().toISOString().split('T')[0]}.csv`);
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            showAlert('Data berhasil diekspor!', 'success');
        }

        // Add keyboard shortcuts
        function initKeyboardShortcuts() {
            document.addEventListener('keydown', (e) => {
                // Ctrl + E to export data
                if (e.ctrlKey && e.key === 'e') {
                    e.preventDefault();
                    exportData();
                }
                
                // Ctrl + R to refresh/reconnect
                if (e.ctrlKey && e.key === 'r') {
                    e.preventDefault();
                    location.reload();
                }
                
                // Ctrl + D to toggle demo mode
                if (e.ctrlKey && e.key === 'd') {
                    e.preventDefault();
                    if (!isDemoMode) {
                        startDemoMode();
                    }
                }
            });
        }

        // Initialize everything when page loads
        document.addEventListener('DOMContentLoaded', function() {
            console.log('SmartEnv Monitor initializing...');
            
            // Initialize chart
            initChart();
            
            // Initialize time selector
            initTimeSelector();
            
            // Initialize keyboard shortcuts
            initKeyboardShortcuts();
            
            // Try to initialize Firebase
            initializeFirebase();
            
            // If Firebase config is incomplete, start demo mode immediately
            if (firebaseConfig.apiKey === "YOUR_API_KEY_HERE") {
                console.log('Firebase config incomplete, starting demo mode...');
                setTimeout(() => {
                    startDemoMode();
                }, 2000);
            }
        });

        // Add error handling for chart
        window.addEventListener('error', function(e) {
            if (e.message.includes('Chart')) {
                console.error('Chart.js error:', e);
                showAlert('Error loading chart. Please refresh the page.', 'error');
            }
        });

        // Add visibility change handler to pause/resume updates
        document.addEventListener('visibilitychange', function() {
            if (document.hidden) {
                // Page is hidden, pause updates
                if (demoInterval) {
                    clearInterval(demoInterval);
                }
            } else {
                // Page is visible, resume updates
                if (isDemoMode) {
                    demoInterval = setInterval(() => {
                        generateDemoData();
                    }, 5000);
                }
            }
        });

        // Add window resize handler for chart
        window.addEventListener('resize', function() {
            if (chart) {
                chart.resize();
            }
        });

        // Service Worker registration for offline functionality (optional)
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', function() {
                // You can implement a service worker for offline functionality
                console.log('Service Worker support detected');
            });
        }

        // Add performance monitoring
        if ('performance' in window) {
            window.addEventListener('load', function() {
                setTimeout(function() {
                    const perfData = performance.timing;
                    const pageLoadTime = perfData.loadEventEnd - perfData.navigationStart;
                    console.log(`Page load time: ${pageLoadTime}ms`);
                    
                    if (pageLoadTime > 3000) {
                        showAlert('Halaman memuat lebih lambat dari biasanya', 'warning');
                    }
                }, 0);
            });
        }
    </script>
</body>
</html>